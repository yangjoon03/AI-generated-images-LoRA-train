---
job: "extension"

config:
  name: "zimage_spring_watercolor_style"

  process:
    - type: "diffusion_trainer"

      # ===============================
      # í•™ìŠµ í´ë” & DB
      # ===============================
      training_folder: "ëª¨ë¸ ì €ì¥ê²½ë¡œ"
      sqlite_db_path: "ëª¨ë¸ ì €ì¥ê²½ë¡œ"
      device: "cuda"

      # ===============================
      # ìŠ¤íƒ€ì¼ í† í°
      # ===============================
      trigger_word: "<springwc>"

      performance_log_every: 0

      # ===============================
      # LoRA ë„¤íŠ¸ì›Œí¬ (ìŠ¤íƒ€ì¼ ì „ì´ìš©)
      # ===============================
      network:
        type: "lora"
        linear: 16
        linear_alpha: 16
        conv: 8
        conv_alpha: 8
        lokr_full_rank: false
        lokr_factor: -1
        network_kwargs:
          ignore_if_contains: []

      # ===============================
      # ì €ì¥ ì„¤ì •
      # ===============================
      save:
        dtype: "bf16"
        save_every: 200
        max_step_saves_to_keep: 20
        save_format: "diffusers"
        push_to_hub: false

      # ===============================
      # ë°ì´í„°ì…‹
      # ===============================
      datasets:
        - folder_path: "í›ˆë ¨ ë°ì´í„° ê²½ë¡œ"
          mask_path: null

          default_caption: "<springwc>"
          caption_ext: ""
          caption_dropout_rate: 0.0

          cache_latents_to_disk: false
          is_reg: false
          network_weight: 1

          resolution:
            - 512  # í•™ìŠµ í•´ìƒë„ëŠ” 512ë¡œ ì•ˆì •í™”

          num_frames: 1
          do_i2v: false
          flip_x: false
          flip_y: false

      # ===============================
      # í•™ìŠµ ì„¤ì •
      # ===============================
      train:
        batch_size: 1
        gradient_accumulation: 1

        steps: 3000  # 300ì¥ ê¸°ì¤€ ì ì ˆ
        lr: 0.0001

        train_unet: true
        train_text_encoder: false  # ğŸ”¥ ìŠ¤íƒ€ì¼ ì „ì´ìš©ì€ OFF

        gradient_checkpointing: true

        noise_scheduler: "flowmatch"
        timestep_type: "weighted"

        content_or_style: "style"

        optimizer: "adamw8bit"
        optimizer_params:
          weight_decay: 0.0004

        dtype: "bf16"

        loss_type: "mse"

        do_differential_guidance: false

      # ===============================
      # ëª¨ë¸
      # ===============================
      model:
        name_or_path: "Tongyi-MAI/Z-Image-Turbo" or "ê²½ë¡œ" ##í—ˆê¹…í˜ì´ìŠ¤ë¡œ ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.
        arch: "zimage:turbo"

        quantize: false        # í•™ìŠµ ì•ˆì •ì„± ìœ„í•´ ë”
        quantize_te: false

        low_vram: true

        assistant_lora_path: "ê²½ë¡œ or ë‹¤ìš´ë¡œë“œ"

      # ===============================
      # ìƒ˜í”Œ (ê²€ì¦ìš©)
      # ===============================
      sample:
        sampler: "flowmatch"
        sample_every: 200
        width: 512
        height: 512
        seed: 42
        guidance_scale: 1
        sample_steps: 8

        prompts:
          - "<springwc> woman"
          - "<springwc> man"
          - "<springwc> ----"

        neg: "photorealistic, ultra realistic, photo, skin pores"

meta:
  name: "[name]"
  version: "1.0"
